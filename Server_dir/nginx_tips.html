<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Jack_Chim nginx_tips 开发笔记_高级_工程师_Blog_Wiki</title>
<meta name="description" content="" />
<meta name="keywords" content="" />
<link rel="stylesheet" type="text/css" href="../css/style.css" media="screen" />
<!-- <link rel="shortcut icon" href="" /> -->
<link rel='stylesheet' id='wp-pagenavi-css'  href='../css/pagenavi-css.css' type='text/css' media='all' />
<script type='text/javascript' src='../js/jquery.js'></script>


<!-- for SyntaxHighlighter core -->
<script type="text/javascript" src="../syntaxhighlighter/scripts/shCore.js"></script>
<link type="text/css" rel="stylesheet" href="../syntaxhighlighter/styles/shCore.css"/>
<!-- for SyntaxHighlighter theme -->
<link type="text/css" rel="stylesheet" href="../syntaxhighlighter/styles/shThemeMidnight.css"/>
<!-- for SyntaxHighlighter syntax -->
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushBash.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushCpp.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushCss.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushJava.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushJScript.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushPhp.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushPython.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushXml.js"></script>
<script type="text/javascript" src="../syntaxhighlighter/scripts/shBrushPlain.js"></script>

<script type="text/javascript" src="../js/jquery.js"></script>

<!-- for SyntaxHighlighter execute -->
<!-- Finally, to actually run the highlighter, you need to include this JS on your page -->
<script type="text/javascript">
     SyntaxHighlighter.all()
</script>
<meta name="generator" content="" />
</head>

<body>
<div align="center">
<div id="wrapper">
<!--// header Start-->
<div id="hd">
	<div id="sitemeta">
		<ul>
			<li class="rss"><a href="http://feed.feedsky.com/">Subscribe to articles using RSS Feed</a></li>
  		</ul>
	</div>
	<div id="titlewrapper">
		<div id="blogtitle">
			<h1><a href="../index.html">Jack Chim'Code Notes</a></h1>
		</div>
		<div id="menu">
			<ul>
				<li><div id="blogdescription"> Keep It Simple and Stupid.</div></li>
				<li><a href="../index.html">Home</a></li>
				<li class="page_item page-item-2"><a href="../about.html">About</a></li>
			</ul>
		</div>
	</div>
	<div class="clear">&nbsp;</div>

	<div class="clear">&nbsp;</div>
</div>
<!--// header End-->


<!--// sidebar Start-->
<div id="sidebar" class="yui-b">
<ul class="sidebar">
<li id="search-3" class="widget widget_search"><form method="get" id="searchform" action="">
<input type="text" size="14" value="" name="s" id="s" class="s" />
<input type="submit" id="searchsubmit" value="GO" />
</form>
<BR><BR></li>
<li id="tag_cloud-3" class="widget widget_tag_cloud"><h2 class="widgettitle">Me</h2>
<br>
<div class="tagcloud">

	<span class="icons_github"></span> <a href='https://github.com/ziikii' target="_blank"  >GitHub </a><br>
	<span class="icons_twitter"></span> <a href='https://twitter.com/jack_chim'  target="_blank" >Twitter </a> <br>
	<span class="icons_linkedin"></span> <a href='http://www.linkedin.com/in/jackchim' target="_blank"  >Linkedin </a><br>
	<span class="icons_sinaweibo"></span> <a href='http://weibo.com/u/1893763090' target="_blank" >Sina Weibo</a><br>
	<span class="icons_mail"></span>     <a href='#'  target="_blank" >Mail:ziikii1#qq.com</a><br>

</div>
</li>
<br>
<li id="categories-4" class="widget widget_categories"><h2 class="widgettitle">Categories</h2>
		<ul>
<li class="cat-item cat-item-67"><a href="../Programming_dir/Programming.html" >Programming</a></li>
<li class="cat-item cat-item-6"><a href="../Security_dir/Security.html" >Security</a></li>
<li class="cat-item cat-item-6"><a href="../Database_dir/Database.html" >Database</a></li>
<li class="cat-item cat-item-6"><a href="../Docs_dir/Docs.html" >Docs</a></li>
<li class="cat-item cat-item-6"><a href="../Desktop_dir/Desktop.html" >Desktop</a></li>
<li class="cat-item cat-item-6"><a href="../OS_dir/OS.html" >OS</a></li>
<li class="cat-item cat-item-6"><a href="../Web_dir/Web.html" >Web</a></li>
<li class="cat-item cat-item-6"><a href="../Develop_dir/Develop.html" >Develop/Tools</a></li>
<li class="cat-item cat-item-6"><a href="../Server_dir/Server.html" >Server</a></li>
<li class="cat-item cat-item-6"><a href="../Editor_dir/Editor.html" >Editor</a></li>
<li class="cat-item cat-item-6"><a href="../Design_dir/Design.html" >Design</a></li>
<li class="cat-item cat-item-6"><a href="../English_dir/English.html" >English notes</a></li>

		</ul>
</li>

<li id="archives-4" class="widget widget_archive"><h2 class="widgettitle"><a href="../diary/diary.html" target="_blank">Diary</a></h2>
		<ul>
	<li><a href='../diary/2012.html' title=''>2012 Year</a></li>
	<li><a href='../diary/2011.html' title=''>2011 Year</a></li>
		</ul>
</li>
<li id="linkcat-2" class="widget widget_links"><h2 class="widgettitle">Site & Tools</h2>

	<ul class='xoxo blogroll'>
<li><a href="http://stackoverflow.com/" target="_blank">Stackoverflow </a></li>
<li><a href="http://www.ostools.net/">ostools</a></li>

	</ul>
</li>

</ul>
</div>
<!--// sidebar End-->



<!--// content Start-->
<div id="content">

<h1 ><a  href="">nginx_tips</a> Page</h1>

<h2 id="toc_0.1">Nginx Rewrite</h2>

<p>
Nginx Rewrite 基本标记(flags)
</p>
<pre>
last - 基本上都用这个flags
break - 中止Rewirte，不再继续匹配
redirect - 返回临时重定向的HTTP状态302
permanent - 返回永久重定向的HTTP状态301
</pre>

<p>
正则表达式匹配
</p>
<pre>
~ 为区分大小写匹配
~* 为不区分大小写匹配
!~和!~* 分别为区分大小写不匹配及不区分大小写不匹配
</pre>

<p>
文件及目录匹配
</p>
<pre>
-f和!-f用来判断是否存在文件
-d和!-d用来判断是否存在目录
-e和!-e用来判断是否存在文件或目录
-x和!-x用来判断文件是否可执行
</pre>

<hr />
<h2 id="toc_0.2">全局变量</h2>

<pre>
$args 
$content_length
$content_type
$document_root
$document_uri
$host 
$http_user_agent
$http_cookie
$limit_rate
$request_body_file
$request_method
$remote_addr
$remote_port
$remote_user
$request_filename 
$request_uri 
$query_string 
$scheme 
$server_protocol 
$server_addr 
$server_name 
$server_port 
$uri
</pre>

<hr />
<h2 id="toc_0.3">Nginx 目录自动加斜线</h2>

<pre>
if (-d $request_filename){ 
rewrite ^/(.*)([^/])$ http://$host/$1$2/ permanent; 
}
</pre>


<hr />
<h2 id="toc_0.4">Nginx Location</h2>

<p>
示例
</p>

<pre>
location ^~ /images/ {
}
</pre>

<pre>
location ~* \.(gif|jpg|jpeg)$ {
}
</pre>

<hr />
<h2 id="toc_0.5">Nginx 访问控制</h2>

<p>
Nginx 禁止访问某类型的文件.
</p>

<pre>
location ~* \.(txt|doc)$ {
if (-f $request_filename) {
root /data/www/wwwroot/linuxtone/test;
deny all;
}
}
</pre>

<hr />
<h2 id="toc_0.6">常见问题与错误处理</h2>

<h4 id="toc_0.6.0.1">1、400 bad request错误的原因和解决办法</h4>
<p>
配置nginx.conf相关设置如下.
client_header_buffer_size 16k;
large_client_header_buffers 4 64k;
根据具体情况调整，一般适当调整值就可以。
</p>

<h4 id="toc_0.6.0.2">2、Nginx 502 Bad Gateway错误</h4>
<p>
proxy_next_upstream error timeout invalid_header http_500 http_503;
或者尝试设置:
large_client_header_buffers 4 32k;
</p>

<h4 id="toc_0.6.0.3">3、Nginx出现的413 Request Entity Too Large错误</h4>
<p>
这个错误一般在上传文件的时候会出现，
编辑Nginx主配置文件Nginx.conf，找到http{}段，添加
client_max_body_size 10m; //设置多大根据自己的需求作调整.
如果运行php的话这个大小client_max_body_size要和php.ini中的如下值的最大值一致或者稍大，这样就不会因为提交数据大小不一致出现的错误。
post_max_size = 10M
upload_max_filesize = 2M
</p>

<h4 id="toc_0.6.0.4">4、解决504 Gateway Time-out(nginx)</h4>
<p>
遇到这个问题是在升级discuz论坛的时候遇到的
一般看来, 这种情况可能是由于nginx默认的fastcgi进程响应的缓冲区太小造成的, 这将导致fastcgi进程被挂起, 如果你的fastcgi服务对这个挂起处理的不好, 那么最后就极有可能导致504 Gateway Time-out
</p>

<p>
现在的网站, 尤其某些论坛有大量的回复和很多内容的, 一个页面甚至有几百K。
默认的fastcgi进程响应的缓冲区是8K, 我们可以设置大点
在nginx.conf里, 加入： fastcgi_buffers 8 128k
这表示设置fastcgi缓冲区为8×128k
当然如果您在进行某一项即时的操作, 可能需要nginx的超时参数调大点，例如设置成60秒：send_timeout 60;
只是调整了这两个参数, 结果就是没有再显示那个超时, 可以说效果不错, 但是也可能是由于其他的原因, 目前关于nginx的资料不是很多, 很多事情都需要长期的经验累计才有结果, 期待您的发现哈!
</p>

<h4 id="toc_0.6.0.5">5、如何使用Nginx Proxy</h4>
<p>
朋友一台服务器运行tomcat 为8080端口,IP:192.168.1.2:8080,另一台机器IP:192.168.1.8. 朋友想通过访问<a href="http://192.168.1.8即可访问tomcat服务.配置如下:">http://192.168.1.8即可访问tomcat服务.配置如下:</a>
在192.168.1.8的nginx.conf上配置如下:
</p>
<pre>
location / {

proxy_pass          http://ssnn.nzdian.com/; #反代的网站
subs_filter_types text/html text/css text/xml text/javascript;  #匹配网页类型
proxy_redirect      off;

proxy_set_header    X-Real-IP       $remote_addr;
proxy_set_header    REMOTE_ADDR $remote_addr;
proxy_set_header    X-Forwarded-For $proxy_add_x_forwarded_for;
</pre>

<h4 id="toc_0.6.0.6">6、如何关闭Nginx的LOG</h4>
<p>
access_log /dev/null; error_log /dev/null;
</p>


<!--// commentwrap Start-->
<!-- 加载duoshuo.com 评论插件 -->
<div id="commentwrap">
<h2>Leave a comment?</h2>
<hr>
    <div id="disqus_thread" style=""></div>

        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'jackchim'; // required: replace example with your forum shortname

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>


        
</div>
<!--// commentwrap End-->

</div>
<!--// content  End-->
<!--// footer Start-->
<div class="clear">&nbsp;</div>
<div id="footnote" align="center">
	  Cheers!! Vimwiki  © Copyright 2012 Jack Chim. All Rights Reserved.
</div>
<!--// footer End-->
<!-- http://blog.sonitech.org/2011/07/06/sshscp-through-gateway/ -->
</div>

</div>
<a href="javascript:;" id="returnTop" style="bottom: 200px;">回到顶部</a>
<script type="text/javascript">
$(document).ready(function(){
    initTxt();
    //$('#returnTop').hide();
    $(window).scroll(function(){
        if($(document).scrollTop()>=100){
            if($.browser.msie&&($.browser.version == "6.0")){
                $('#returnTop').css("_top","expression(eval(document.documentElement.scrollTop+(document.documentElement.clientHeight/2)-this.offsetHeight-(parseInt(this.currentStyle.marginTop,10)||0)-(parseInt(this.currentStyle.marginBottom,10)||0))-0);");
            }
            $('#returnTop').animate({bottom:"200px"},{ queue: false, duration: 10 });
        }else{
            $('#returnTop').css("_top","1000");
            $('#returnTop').animate({bottom:"-200px"},{ queue: false, duration: 10 });
        }
    });
    $('#returnTop').click(function(){
        $('html, body').animate({scrollTop:0}, 'slow');
        return false;
    });
 
     
});
 
function initTxt(){
    for(var i=0;i<=300;i++){
        $("#bigBox").append("<p>这是第"+i+"行</p>");
    }
}
</script>
</body>
</html>
